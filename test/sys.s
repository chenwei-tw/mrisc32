; =============================================================================
; == System library
; =============================================================================

; -----------------------------------------------------------------------------
; exit(int exit_code)
; -----------------------------------------------------------------------------
_exit:
  ; exit routine: 0xffff0000
  ldihi  r16, -8       ; Upper 19 bits = 0b1111111111111111000
  ori    r16, r16, 0   ; Lower 14 bits = 0b00000000000000
  jmp    r16


; -----------------------------------------------------------------------------
; putc(int c)
; -----------------------------------------------------------------------------
_putc:
  ; putc routine: 0xffff0004
  ldihi  r16, -8       ; Upper 19 bits = 0b1111111111111111000
  ori    r16, r16, 4   ; Lower 14 bits = 0b00000000000100
  jmp    r16


; -----------------------------------------------------------------------------
; puts(char* s)
; -----------------------------------------------------------------------------
_puts:
  st.w   lr, sp, -4
  subi   sp, sp, 4

  mov    r12, r4
  ldi    r13, 0
__puts_loop:
  ldx.b  r4, r12, r13
  andi   r4, r4, 255
  addi   r13, r13, 1
  beq    r4, __puts_eos
  bsr    _putc
  bra    __puts_loop

__puts_eos:
  ldi    r4, 10
  bsr    _putc

  ld.w   lr, sp, 0
  addi   sp, sp, 4
  rts

